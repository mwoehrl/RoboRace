TurnTableFrames:
;Frame 0
	defb 010h, 000h, 003h, 007h, 00Fh, 01Fh, 03Fh, 03Bh    ;0A3h
	defb 000h, 07Eh, 0FBh, 0F9h, 0C0h, 080h, 080h, 073h    ;0A4h
	defb 001h, 001h, 0C1h, 0E1h, 0F1h, 079h, 0FDh, 0FDh    ;0A5h
	defb 031h, 061h, 040h, 070h, 071h, 071h, 079h, 03Eh    ;0B3h
	defb 008h, 000h, 000h, 098h, 019h, 000h, 000h, 010h    ;0B4h
	defb 07Ch, 09Eh, 08Eh, 08Eh, 00Eh, 002h, 086h, 08Ch    ;0B5h
	defb 03Fh, 03Fh, 01Eh, 00Fh, 007h, 003h, 000h, 000h    ;0C3h
	defb 0CEh, 001h, 001h, 003h, 09Fh, 0DFh, 07Eh, 000h    ;0C4h
	defb 0DDh, 0FDh, 0F9h, 0F1h, 0E1h, 0C1h, 001h, 000h    ;0C5h
;Frame 1
	defb 010h, 000h, 003h, 007h, 00Fh, 01Fh, 03Fh, 03Dh    ;0A3h
	defb 000h, 07Eh, 0FDh, 0FDh, 080h, 080h, 080h, 0B8h    ;0A4h
	defb 001h, 001h, 0C1h, 0E1h, 0F1h, 0F9h, 07Dh, 0FDh    ;0A5h
	defb 030h, 040h, 070h, 071h, 071h, 071h, 070h, 03Fh    ;0B3h
	defb 085h, 000h, 080h, 018h, 018h, 001h, 000h, 0A1h    ;0B4h
	defb 0FCh, 00Eh, 08Eh, 08Eh, 08Eh, 00Eh, 002h, 00Ch    ;0B5h
	defb 03Fh, 03Eh, 01Fh, 00Fh, 007h, 003h, 000h, 000h    ;0C3h
	defb 01Dh, 001h, 001h, 001h, 0BFh, 0BFh, 07Eh, 000h    ;0C4h
	defb 0BDh, 0FDh, 0F9h, 0F1h, 0E1h, 0C1h, 001h, 000h    ;0C5h
;Frame 2
	defb 010h, 000h, 003h, 007h, 00Fh, 01Fh, 03Dh, 038h    ;0A3h
	defb 000h, 07Eh, 0FFh, 0EEh, 0C0h, 0C0h, 080h, 098h    ;0A4h
	defb 001h, 001h, 0C1h, 0E1h, 0F1h, 079h, 03Dh, 07Dh    ;0A5h
	defb 020h, 070h, 070h, 071h, 061h, 070h, 07Ch, 03Fh    ;0B3h
	defb 085h, 000h, 080h, 018h, 018h, 001h, 000h, 0A1h    ;0B4h
	defb 0FCh, 03Eh, 00Eh, 086h, 08Eh, 00Eh, 00Eh, 004h    ;0B5h
	defb 03Eh, 03Ch, 01Eh, 00Fh, 007h, 003h, 000h, 000h    ;0C3h
	defb 019h, 001h, 003h, 003h, 077h, 0FFh, 07Eh, 000h    ;0C4h
	defb 01Dh, 0BDh, 0F9h, 0F1h, 0E1h, 0C1h, 001h, 000h    ;0C5h
;Frame 3
	defb 010h, 000h, 003h, 007h, 00Fh, 01Fh, 03Ch, 020h    ;0A3h
	defb 000h, 07Eh, 0FFh, 0FFh, 0E0h, 0C0h, 0D0h, 0CCh    ;0A4h
	defb 001h, 001h, 0C1h, 061h, 071h, 079h, 03Dh, 03Dh    ;0A5h
	defb 030h, 070h, 071h, 071h, 072h, 078h, 07Fh, 03Fh    ;0B3h
	defb 004h, 000h, 080h, 018h, 018h, 001h, 000h, 020h    ;0B4h
	defb 0FCh, 0FEh, 01Eh, 04Eh, 08Eh, 08Eh, 00Eh, 00Ch    ;0B5h
	defb 03Ch, 03Ch, 01Eh, 00Eh, 006h, 003h, 000h, 000h    ;0C3h
	defb 033h, 00Bh, 003h, 007h, 0FFh, 0FFh, 07Eh, 000h    ;0C4h
	defb 005h, 03Dh, 0F9h, 0F1h, 0E1h, 0C1h, 001h, 000h    ;0C5h
;Frame 4
	defb 010h, 000h, 003h, 007h, 00Fh, 01Fh, 038h, 030h    ;0A3h
	defb 000h, 07Eh, 0FFh, 0FFh, 0E1h, 0E0h, 0C0h, 04Ch    ;0A4h
	defb 001h, 001h, 0C1h, 0E1h, 071h, 039h, 03Dh, 03Dh    ;0A5h
	defb 038h, 070h, 071h, 071h, 070h, 07Ch, 07Fh, 03Eh    ;0B3h
	defb 000h, 000h, 000h, 018h, 018h, 000h, 000h, 000h    ;0B4h
	defb 07Ch, 0FEh, 03Eh, 00Eh, 08Eh, 08Eh, 00Eh, 01Ch    ;0B5h
	defb 03Ch, 03Ch, 01Ch, 00Eh, 007h, 003h, 000h, 000h    ;0C3h
	defb 032h, 003h, 007h, 087h, 0FFh, 0FFh, 07Eh, 000h    ;0C4h
	defb 00Dh, 01Dh, 0F9h, 0F1h, 0E1h, 0C1h, 001h, 000h    ;0C5h
;Frame 5
	defb 010h, 000h, 003h, 007h, 00Fh, 01Eh, 030h, 038h    ;0A3h
	defb 000h, 07Eh, 0FFh, 0FFh, 0F1h, 070h, 068h, 04Ch    ;0A4h
	defb 001h, 001h, 0C1h, 0E1h, 0B1h, 039h, 03Dh, 01Dh    ;0A5h
	defb 038h, 070h, 071h, 073h, 07Ch, 07Eh, 07Fh, 038h    ;0B3h
	defb 000h, 042h, 000h, 018h, 018h, 000h, 042h, 000h    ;0B4h
	defb 01Ch, 0FEh, 07Eh, 03Eh, 0CEh, 08Eh, 00Eh, 01Ch    ;0B5h
	defb 038h, 03Ch, 01Ch, 00Dh, 007h, 003h, 000h, 000h    ;0C3h
	defb 032h, 016h, 00Eh, 08Fh, 0FFh, 0FFh, 07Eh, 000h    ;0C4h
	defb 01Dh, 00Dh, 079h, 0F1h, 0E1h, 0C1h, 001h, 000h    ;0C5h
;Frame 6
	defb 010h, 000h, 003h, 007h, 00Fh, 010h, 038h, 038h    ;0A3h
	defb 000h, 07Eh, 0FFh, 0FFh, 0F9h, 030h, 020h, 024h    ;0A4h
	defb 001h, 001h, 0C1h, 0E1h, 0D1h, 019h, 01Dh, 01Dh    ;0A5h
	defb 038h, 070h, 071h, 078h, 07Ch, 07Fh, 078h, 038h    ;0B3h
	defb 002h, 0C2h, 000h, 018h, 018h, 000h, 043h, 040h    ;0B4h
	defb 01Ch, 01Eh, 0FEh, 03Eh, 01Eh, 08Eh, 00Eh, 01Ch    ;0B5h
	defb 038h, 038h, 018h, 00Bh, 007h, 003h, 000h, 000h    ;0C3h
	defb 024h, 004h, 00Ch, 09Fh, 0FFh, 0FFh, 07Eh, 000h    ;0C4h
	defb 01Dh, 01Dh, 009h, 0F1h, 0E1h, 0C1h, 001h, 000h    ;0C5h
;Frame 7
	defb 010h, 000h, 003h, 007h, 00Bh, 018h, 03Ch, 038h    ;0A3h
	defb 000h, 07Eh, 0FFh, 0FFh, 07Eh, 038h, 034h, 026h    ;0A4h
	defb 001h, 001h, 0C1h, 0E1h, 0F1h, 049h, 01Dh, 01Dh    ;0A5h
	defb 030h, 079h, 07Bh, 07Ch, 07Eh, 07Fh, 078h, 030h    ;0B3h
	defb 082h, 082h, 000h, 018h, 018h, 000h, 003h, 040h    ;0B4h
	defb 00Ch, 01Eh, 0FEh, 07Eh, 03Eh, 0DEh, 09Eh, 00Ch    ;0B5h
	defb 038h, 038h, 012h, 00Fh, 007h, 003h, 000h, 000h    ;0C3h
	defb 064h, 02Ch, 01Ch, 07Eh, 0FFh, 0FFh, 07Eh, 000h    ;0C4h
	defb 01Dh, 03Dh, 019h, 0D1h, 0E1h, 0C1h, 001h, 000h    ;0C5h
;Frame 8
	defb 010h, 000h, 003h, 007h, 00Ch, 01Eh, 03Ch, 038h    ;0A3h
	defb 000h, 07Eh, 0FFh, 0FFh, 09Fh, 01Ch, 010h, 006h    ;0A4h
	defb 001h, 001h, 0C1h, 0E1h, 0F1h, 079h, 02Dh, 00Dh    ;0A5h
	defb 038h, 079h, 07Dh, 07Ch, 07Eh, 070h, 070h, 038h    ;0B3h
	defb 083h, 080h, 000h, 018h, 018h, 000h, 001h, 0C1h    ;0B4h
	defb 01Ch, 00Eh, 00Eh, 07Eh, 03Eh, 0BEh, 09Eh, 01Ch    ;0B5h
	defb 030h, 034h, 01Eh, 00Fh, 007h, 003h, 000h, 000h    ;0C3h
	defb 060h, 008h, 038h, 0F9h, 0FFh, 0FFh, 07Eh, 000h    ;0C4h
	defb 01Dh, 03Dh, 079h, 031h, 0E1h, 0C1h, 001h, 000h    ;0C5h
;Frame 9
	defb 010h, 000h, 003h, 006h, 00Eh, 01Eh, 03Ch, 038h    ;0A3h
	defb 000h, 07Eh, 0FFh, 0FFh, 00Fh, 01Eh, 018h, 012h    ;0A4h
	defb 001h, 001h, 0C1h, 0E1h, 0F1h, 079h, 03Dh, 005h    ;0A5h
	defb 038h, 07Dh, 07Ch, 07Eh, 077h, 070h, 070h, 030h    ;0B3h
	defb 0E3h, 081h, 001h, 018h, 018h, 080h, 081h, 0C7h    ;0B4h
	defb 00Ch, 00Eh, 00Eh, 0EEh, 07Eh, 03Eh, 0BEh, 01Ch    ;0B5h
	defb 020h, 03Ch, 01Eh, 00Fh, 007h, 003h, 000h, 000h    ;0C3h
	defb 048h, 018h, 078h, 0F0h, 0FFh, 0FFh, 07Eh, 000h    ;0C4h
	defb 01Dh, 03Dh, 079h, 071h, 061h, 0C1h, 001h, 000h    ;0C5h
;Frame 10
	defb 010h, 000h, 003h, 006h, 00Fh, 01Eh, 03Ch, 03Ch    ;0A3h
	defb 000h, 07Eh, 0FFh, 03Fh, 007h, 00Fh, 00Ch, 002h    ;0A4h
	defb 001h, 001h, 0C1h, 0E1h, 0F1h, 0F9h, 03Dh, 015h    ;0A5h
	defb 03Ch, 07Dh, 07Eh, 076h, 070h, 070h, 060h, 020h    ;0B3h
	defb 0E1h, 001h, 001h, 018h, 018h, 080h, 080h, 087h    ;0B4h
	defb 004h, 006h, 00Eh, 00Eh, 06Eh, 07Eh, 0BEh, 03Ch    ;0B5h
	defb 028h, 03Ch, 01Fh, 00Fh, 007h, 003h, 000h, 000h    ;0C3h
	defb 040h, 030h, 0F0h, 0E0h, 0FCh, 0FFh, 07Eh, 000h    ;0C4h
	defb 03Dh, 03Dh, 079h, 0F1h, 061h, 0C1h, 001h, 000h    ;0C5h
;Frame 11
	defb 010h, 000h, 003h, 007h, 00Fh, 01Eh, 03Ch, 03Ch    ;0A3h
	defb 000h, 07Eh, 0FFh, 01Fh, 087h, 007h, 00Eh, 001h    ;0A4h
	defb 001h, 001h, 0C1h, 0E1h, 0F1h, 0F9h, 03Dh, 01Dh    ;0A5h
	defb 03Dh, 07Eh, 07Eh, 072h, 070h, 060h, 060h, 028h    ;0B3h
	defb 0D1h, 001h, 000h, 019h, 098h, 000h, 080h, 08Bh    ;0B4h
	defb 014h, 006h, 006h, 00Eh, 04Eh, 07Eh, 07Eh, 0BCh    ;0B5h
	defb 038h, 03Ch, 01Fh, 00Fh, 007h, 003h, 000h, 000h    ;0C3h
	defb 080h, 070h, 0E0h, 0E1h, 0F8h, 0FFh, 07Eh, 000h    ;0C4h
	defb 03Dh, 03Dh, 079h, 0F1h, 0E1h, 0C1h, 001h, 000h    ;0C5h
;Frame 12
	defb 010h, 000h, 003h, 007h, 00Fh, 01Eh, 03Ch, 03Ch    ;0A3h
	defb 000h, 07Eh, 0BFh, 087h, 083h, 007h, 007h, 020h    ;0A4h
	defb 001h, 001h, 0C1h, 0E1h, 0F1h, 0F9h, 03Dh, 01Dh    ;0A5h
	defb 03Eh, 07Eh, 076h, 060h, 060h, 061h, 040h, 038h    ;0B3h
	defb 0D1h, 001h, 000h, 019h, 098h, 000h, 080h, 08Bh    ;0B4h
	defb 01Ch, 002h, 086h, 006h, 006h, 06Eh, 07Eh, 07Ch    ;0B5h
	defb 038h, 03Ch, 01Fh, 00Fh, 007h, 003h, 000h, 000h    ;0C3h
	defb 004h, 0E0h, 0E0h, 0C1h, 0E1h, 0FDh, 07Eh, 000h    ;0C4h
	defb 03Dh, 03Dh, 079h, 0F1h, 0E1h, 0C1h, 001h, 000h    ;0C5h
;Frame 13
	defb 010h, 000h, 003h, 007h, 00Fh, 01Fh, 03Eh, 03Eh    ;0A3h
	defb 000h, 07Eh, 0DFh, 0CFh, 081h, 003h, 003h, 064h    ;0A4h
	defb 001h, 001h, 0C1h, 0E1h, 0F1h, 0F9h, 0FDh, 03Dh    ;0A5h
	defb 03Eh, 076h, 071h, 070h, 060h, 041h, 071h, 038h    ;0B3h
	defb 091h, 000h, 000h, 019h, 098h, 000h, 000h, 089h    ;0B4h
	defb 01Ch, 08Eh, 082h, 006h, 00Eh, 08Eh, 06Eh, 07Ch    ;0B5h
	defb 03Ch, 03Fh, 01Fh, 00Fh, 007h, 003h, 000h, 000h    ;0C3h
	defb 026h, 0C0h, 0C0h, 081h, 0F3h, 0FBh, 07Eh, 000h    ;0C4h
	defb 07Dh, 07Dh, 0F9h, 0F1h, 0E1h, 0C1h, 001h, 000h    ;0C5h
;Frame 14
	defb 010h, 000h, 003h, 007h, 00Fh, 01Eh, 03Eh, 03Fh    ;0A3h
	defb 000h, 07Eh, 0EFh, 0E7h, 003h, 001h, 003h, 073h    ;0A4h
	defb 001h, 001h, 0C1h, 0E1h, 0F1h, 0F9h, 0FDh, 09Dh    ;0A5h
	defb 03Fh, 07Bh, 070h, 060h, 041h, 071h, 071h, 030h    ;0B3h
	defb 008h, 000h, 000h, 098h, 019h, 000h, 000h, 010h    ;0B4h
	defb 00Ch, 08Eh, 08Eh, 082h, 006h, 00Eh, 0DEh, 0FCh    ;0B5h
	defb 039h, 03Fh, 01Fh, 00Fh, 007h, 003h, 000h, 000h    ;0C3h
	defb 0CEh, 0C0h, 080h, 0C0h, 0E7h, 0F7h, 07Eh, 000h    ;0C4h
	defb 0FDh, 07Dh, 079h, 0F1h, 0E1h, 0C1h, 001h, 000h    ;0C5h

;HL points to Frame start
MirrorTurntableFrame:
	PUSH HL

	PUSH HL
	LD B, 9
 mirrorTurntableFrame_loop:
	CALL Mirror8Bytes
	DJNZ mirrorTurntableFrame_loop
	POP HL

	PUSH HL
	LD DE, SpriteTransformBuffer
	LD BC, 24
	LDIR		;Rows 0-2 to buffer
	LD DE, 24
	ADD HL, DE		;HL Points to Row6
	POP DE			;DE Points to Row0
	LD BC, 24
	LDIR		;Rows 6-8 to Row 0-2
	LD HL, 24
	ADD HL, DE	
	EX DE, HL	;DE points to row6
	LD HL, SpriteTransformBuffer
	LD BC, 24
	LDIR		;buffer to Row 6-8
	POP HL
	RET

Mirror8Bytes:
	PUSH BC
	INC HL
	INC HL
	INC HL
	LD D, H
	LD E, L
	INC HL
	LD B, 4
 mirror8Bytes_loop:
	LD C, (HL)
	LD A, (DE)
	LD (HL), A
	LD A, C
	LD (DE), A
	INC HL
	DEC DE
	DJNZ mirror8Bytes_loop
	POP BC
	RET

OnTurntableClockwise:
	INC (IX+2)
	JP PutRobot

OnTurntableCounter:
	DEC (IX+2)
	JP PutRobot

BoardPhase_Turntables:
	CALL ResetHotspots
	CALL PreCheckBots_Turntable
    LD A, (HotspotCount)
    AND A
    RET Z   ;If no robot is moved, skip Animation
    CALL ScrollToHotspots
    LD HL, FX_Rotate
	CALL PlaySoundFX
	LD B, 16
    LD HL, TurnTableFrames
boardPhase_Turntables_loop:
	CALL AnimateTurntables
	PUSH HL
	PUSH BC
	CALL Put_All_Robots
	CALL HALT_Animation
	CALL CheckBots_Turntable
    POP BC
	POP HL
	CALL HALT_Animation
    DJNZ boardPhase_Turntables_loop
	RET

PreCheckBots_Turntable:
	LD IX, Player1State
	CALL PreCheckBot_Turntable
	LD IX, Player2State
	CALL PreCheckBot_Turntable
	LD IX, Player3State
PreCheckBot_Turntable:
	CALL CheckTurntableFlag
	RET Z
	CALL AddHotspot_Player
	RET

CheckTurntableFlag:
	CALL calculate_World_Position_DE
	LD A, (DE)
	ADD A, A
	LD D, 0
	LD E, A
	LD HL, TileFlags+1		;Tile Action Flags
	ADD HL, DE
	LD A, (HL)				;Tile Action Flag byte
	AND 4					;Turntable Flag
	RET

CheckBots_Turntable:
	LD IX, Player1State
	CALL CheckBot_Turntable
	LD IX, Player2State
	CALL CheckBot_Turntable
	LD IX, Player3State
CheckBot_Turntable:
	CALL CheckTurntableFlag
	RET Z
	LD BC, TileActions-(TileFlags+1)
	ADD HL, BC
	LD E, (HL)
	INC HL
	LD D, (HL)
	EX DE, HL
	JP (HL)

copy3CharRows_3Times:
    LD BC, 104			;When the source is the original charset, skip chars
    JR $+5
copy3TurnTableRows_3Times:
    LD BC, 0
    LD (copyTurnTableRow_repogram+1), BC
    
	LD A, (TitleMode)
	AND A
	JR NZ, skip_copy_turtable_sections	
	CALL copy3TurnTableRows
    EX DE, HL
    LD BC, $0800 - 16*8*3
    ADD HL, BC
    EX DE, HL
    CALL copy3TurnTableRows
    EX DE, HL
    LD BC, $0800 - 16*8*3
    ADD HL, BC
    EX DE, HL
	JR copy3TurnTableRows
skip_copy_turtable_sections:
	LD A, D
	ADD A, 16
	LD D, A
copy3TurnTableRows:
    PUSH HL
    CALL copyTurnTableRow
    CALL copyTurnTableRow
    CALL copyTurnTableRow
    POP HL
    RET    

copyTurnTableRow:
    LD B, 3
    CALL COPY_RAM_TO_VRAM_unrolled
    EX DE, HL
    LD BC, 16*8
    ADD HL, BC
    EX DE, HL
copyTurnTableRow_repogram:
    LD BC, 0        ;REPROGRAM to 16*8-24=104
    ADD HL, BC
    RET

;B=Phase 16...2, 1
;HL=Current Frame
AnimateTurntables:
	PUSH BC

    LD A, 1
	CP B
	JR Z, Turntable_Zero	

    LD DE, $0000 + 163*8
    CALL copy3TurnTableRows_3Times
    CALL MirrorTurntableFrame

    LD DE, $0000 + 160*8
    CALL copy3TurnTableRows_3Times
    CALL MirrorTurntableFrame

    LD DE, 72
    ADD HL, DE
    POP BC
    RET
	
Turntable_Zero:	
    LD HL, CharPatterns + 160*8
    LD DE, $0000 + 160*8
    CALL copy3CharRows_3Times

    LD HL, CharPatterns + 163*8
    LD DE, $0000 + 163*8
    CALL copy3CharRows_3Times

    POP BC
    RET